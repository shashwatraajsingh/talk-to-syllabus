"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.teardown = void 0;
const pinecone_1 = require("../pinecone");
/**
 * Integration Test Teardown Script
 *
 * Cleans up shared resources created by the setup script.
 * Reads resource information from FIXTURES_JSON environment variable.
 */
const teardown = async () => {
    const apiKey = process.env.PINECONE_API_KEY;
    if (!apiKey) {
        throw new Error('PINECONE_API_KEY environment variable not set');
    }
    const fixturesJson = process.env.FIXTURES_JSON;
    if (!fixturesJson) {
        throw new Error('FIXTURES_JSON environment variable not set. Nothing to clean up.');
    }
    let fixtures;
    try {
        fixtures = JSON.parse(fixturesJson);
    }
    catch (error) {
        throw new Error(`Failed to parse FIXTURES_JSON: ${error}. Value: ${fixturesJson}`);
    }
    const pc = new pinecone_1.Pinecone({ apiKey });
    console.error('üßπ Cleaning up integration test resources...');
    // Delete serverless index
    if (fixtures.serverlessIndex?.name) {
        try {
            console.error(`üì¶ Deleting index: ${fixtures.serverlessIndex.name}`);
            await pc.deleteIndex(fixtures.serverlessIndex.name);
            console.error('‚úÖ Index deleted');
        }
        catch (error) {
            console.error('‚ùå Failed to delete index:', error);
            // Continue with assistant cleanup even if index deletion fails
        }
    }
    else {
        console.error('‚ö†Ô∏è  No serverless index name found in FIXTURES_JSON');
    }
    // Delete assistant
    if (fixtures.assistant?.name) {
        try {
            console.error(`ü§ñ Deleting assistant: ${fixtures.assistant.name}`);
            await pc.deleteAssistant(fixtures.assistant.name);
            console.error('‚úÖ Assistant deleted');
        }
        catch (error) {
            console.error('‚ùå Failed to delete assistant:', error);
        }
    }
    else {
        console.error('‚ö†Ô∏è  No assistant name found in FIXTURES_JSON');
    }
    console.error('‚úÖ Teardown complete!');
};
exports.teardown = teardown;
if (require.main === module) {
    (0, exports.teardown)()
        .then(() => {
        process.exit(0);
    })
        .catch((err) => {
        console.error('‚ùå Teardown script failed:', err);
        process.exit(1);
    });
}
//# sourceMappingURL=teardown.js.map