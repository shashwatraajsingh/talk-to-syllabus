"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deleteMany = void 0;
const db_data_1 = require("../../pinecone-generated-ts-fetch/db_data");
const errors_1 = require("../../errors");
const deleteMany = (apiProvider, targetNamespace) => {
    const validator = (options) => {
        if (!options.ids && !options.filter) {
            throw new errors_1.PineconeArgumentError('Either `ids` or `filter` must be provided.');
        }
        if (options.ids && options.filter) {
            throw new errors_1.PineconeArgumentError('Cannot provide both `ids` and `filter`. Use either `ids` to delete specific records or `filter` to delete by metadata.');
        }
        if (options.ids && options.ids.length === 0) {
            throw new errors_1.PineconeArgumentError('Must pass in at least 1 record ID.');
        }
        if (options.filter) {
            for (const key in options.filter) {
                if (!options.filter[key]) {
                    throw new errors_1.PineconeArgumentError(`\`filter\` property cannot be empty for key ${key}`);
                }
            }
        }
    };
    return async (options) => {
        validator(options);
        const namespace = options.namespace ?? targetNamespace;
        const requestOptions = {};
        if (options.ids) {
            requestOptions.ids = options.ids;
        }
        else if (options.filter) {
            requestOptions.filter = options.filter;
        }
        const api = await apiProvider.provide();
        await api.deleteVectors({
            xPineconeApiVersion: db_data_1.X_PINECONE_API_VERSION,
            deleteRequest: { ...requestOptions, namespace },
        });
        return;
    };
};
exports.deleteMany = deleteMany;
//# sourceMappingURL=deleteMany.js.map