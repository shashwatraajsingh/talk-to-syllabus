"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.UpsertCommand = void 0;
const db_data_1 = require("../../pinecone-generated-ts-fetch/db_data");
const errors_1 = require("../../errors");
class UpsertCommand {
    apiProvider;
    namespace;
    constructor(apiProvider, namespace) {
        this.apiProvider = apiProvider;
        this.namespace = namespace;
    }
    validator = (options) => {
        if (!options.records || options.records.length === 0) {
            throw new errors_1.PineconeArgumentError('Must pass in at least 1 record to upsert.');
        }
        options.records.forEach((record) => {
            if (!record.id) {
                throw new errors_1.PineconeArgumentError('Every record must include an `id` property in order to upsert.');
            }
            if (!record.values && !record.sparseValues) {
                throw new errors_1.PineconeArgumentError('Every record must include either `values` or `sparseValues` in order to upsert.');
            }
        });
    };
    async run(options) {
        this.validator(options);
        const namespace = options.namespace ?? this.namespace;
        const api = await this.apiProvider.provide();
        await api.upsertVectors({
            xPineconeApiVersion: db_data_1.X_PINECONE_API_VERSION,
            upsertRequest: {
                vectors: options.records,
                namespace,
            },
        });
    }
}
exports.UpsertCommand = UpsertCommand;
//# sourceMappingURL=upsert.js.map