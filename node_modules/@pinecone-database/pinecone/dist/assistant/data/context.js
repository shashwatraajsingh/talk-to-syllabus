"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.context = void 0;
const assistant_data_1 = require("../../pinecone-generated-ts-fetch/assistant_data");
const errors_1 = require("../../errors");
/**
 * Retrieves [the context snippets](https://docs.pinecone.io/guides/assistant/understanding-context-snippets) used
 * by an Assistant during the retrieval process.
 *
 * @example
 * ```typescript
 * import { Pinecone } from '@pinecone-database/pinecone';
 * const pc = new Pinecone();
 * const assistantName = 'test1';
 * const assistant = pc.assistant({ name: assistantName });
 * const response = await assistant.context({query: "What is the capital of France?"});
 * console.log(response);
 * // {
 * //  snippets: [
 * //    {
 * //      type: 'text',
 * //      content: 'The capital of France is Paris.',
 * //      score: 0.9978925,
 * //      reference: [Object]
 * //    },
 * //  ],
 * //  usage: { promptTokens: 527, completionTokens: 0, totalTokens: 527 }
 * // }
 * ```
 *
 * @param assistantName - The name of the Assistant to retrieve the context snippets from.
 * @param api - The Pinecone API object.
 * @throws An error if a query is not provided.
 * @returns A promise that resolves to a {@link ContextModel} object containing the context snippets.
 */
const context = (assistantName, apiProvider) => {
    return async (options) => {
        validateContextOptions(options);
        const api = await apiProvider.provideData();
        return await api.contextAssistant({
            assistantName: assistantName,
            xPineconeApiVersion: assistant_data_1.X_PINECONE_API_VERSION,
            contextRequest: {
                query: options.query,
                filter: options.filter,
                messages: toMessageModel(options.messages),
                topK: options.topK,
                snippetSize: options.snippetSize,
                multimodal: options.multimodal,
                includeBinaryContent: options.includeBinaryContent,
            },
        });
    };
};
exports.context = context;
const validateContextOptions = (options) => {
    if (!options || (!options.query && !options.messages)) {
        throw new errors_1.PineconeArgumentError('You must pass an object with required properties (`query`, or `messages`) to retrieve context snippets.');
    }
};
const toMessageModel = (messages) => {
    if (!messages) {
        return undefined;
    }
    if (Array.isArray(messages) && typeof messages[0] === 'string') {
        return messages.map((message) => {
            return { role: 'user', content: message };
        });
    }
    if (Array.isArray(messages) && typeof messages[0] === 'object') {
        return messages;
    }
    return undefined;
};
//# sourceMappingURL=context.js.map